{% extends "base.html" %} {% block content %}
<h2>ğŸ¥ Health Authority Dashboard</h2>

<div class="alert-box {{ 'alert' if alert.status == 'ALERT' else 'safe' }}">
  <h3>{{ alert.message }}</h3>
</div>

<h3>ğŸ“ Disease Cases by Location</h3>
<div class="location-cards">
  {% for location, diseases in location_diseases.items() %}
  <div class="location-card">
    <h4>
      {{ location }} ({{ diseases|length }} case{{ 's' if diseases|length != 1
      else '' }})
    </h4>
    <ul class="disease-list">
      {% for disease in diseases %}
      <li>{{ disease|title }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}
</div>

<hr />

<h3>ğŸ“‹ All Case Reports (with Private Notes)</h3>
<div class="report-list">
  {% for report in current_user.reports %}
  <div>
    <strong>{{ report.disease.title() }}</strong> in {{ report.location }} ({{
    report.days_ago }} days ago) - Patient ID: {{ report.patient_id }} {% if
    report.hospital_id == current_user.id %} {% if report.encrypted_notes %}
    <p><em>ğŸ”’ Private Notes:</em> {{ report.get_decrypted_notes() }}</p>
    {% endif %} {% else %}
    <p><em>ğŸ”’ Private Notes:</em> Not accessible</p>
    {% endif %}
  </div>
  {% endfor %}
</div>

<style>
  .report-list {
    margin-top: 20px;
  }
  .report-item {
    padding: 12px;
    border: 1px solid #eee;
    border-radius: 6px;
    margin-bottom: 10px;
    background: #fafafa;
  }
  .private-notes {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px dashed #ccc;
  }
  .private-notes p {
    margin: 4px 0 0;
    color: #2c5234;
    font-style: italic;
  }
</style>

{% endblock %}
